import numpy as np
import matplotlib.pyplot as plt
import argparse


def get_plasma_boundary():
    rtf1 = np.array([2.9428376046, 2.9428376046, 2.8867393593, 3.0572349982, 3.6032876981,
                     4.4215507122, 5.3475701620, 6.3316847779, 7.2431024132, 8.0735532943,
                     8.8020764168, 9.4981706117, 10.010267503, 10.321214153, 10.4284,
                     10.360750887, 10.15910248, 9.826659918, 9.3695228163, 8.5916344670,
                     7.6392794606, 6.5507349158, 5.3474495018, 4.3454905742, 3.5046471402,
                     2.9854512915, 2.8867393593, 2.9428376046])

    ztf1 = np.array([-1.7115284025, 1.7115284025, 3.4839791563, 4.6778678926, 5.4267854228,
                     5.8683358097, 6.0068903227, 5.8431371695, 5.4301588999, 4.8758939896,
                     4.1972791404, 3.2761696851, 2.2453192802, 1.1410561783, 0.0,
                     -0.91938716865, -1.8194835047, -2.6819883225, -3.4881686527, -4.4335762929,
                     -5.2111349975, -5.7879230430, -6.0330772446, -5.8528570060, -5.3346220450,
                     -4.4884994557, -3.4839791563, -1.7115284025])

    rtf2 = np.array([2.4681623954, 2.4681623954, 2.5242606407, 2.7675650018, 3.3835123019,
                     4.2802492878, 5.2888298380, 6.3625152221, 7.3644975868, 8.2864467057,
                     9.1041235832, 9.8952293883, 10.484932497, 10.847185847, 10.9724,
                     10.893049113, 10.65749752, 10.272140082, 9.7474771837, 8.8661655330,
                     7.8025205394, 6.6022650842, 5.2889504982, 4.1975094258, 3.2741528598,
                     2.6821487085, 2.5242606407, 2.4681623954])

    ztf2 = np.array([-1.9772715975, 1.9772715975, 3.8896208437, 5.1383321074, 5.9244145772,
                     6.3936641903, 6.5477096773, 6.3862628305, 5.9604411001, 5.3765060104,
                     4.6497208596, 3.6480303149, 2.5110807198, 1.2799438217, 0.0,
                     -1.0316128314, -2.0375164953, -2.9942116775, -3.8794313473, -4.9032237071,
                     -5.7300650025, -6.3294769570, -6.5739227554, -6.3763429940, -5.8273779550,
                     -4.9401005443, -3.8896208437, -1.9772715975])
    return rtf1, ztf1, rtf2, ztf2

def get_cs_coils():
    rcspf = np.array([1.6960000000E+00, 1.6960000000E+00, 1.6960000000E+00, 1.6960000000E+00, 1.6960000000E+00,
                      1.6960000000E+00, 3.9431000000E+00, 8.2851000000E+00, 1.1991900000E+01, 1.1963000000E+01,8.3908000000E+00,4.3340000000E+00])

    zcspf = np.array([5.4350000000E+00, 3.2650000000E+00, 1.0950000000E+00, -1.0750000000E+00, -3.2450000000E+00,
                      -5.4150000000E+00, 7.5741000000E+00, 6.5398000000E+00, 3.2752000000E+00, -2.2336000000E+00,
                      -6.7269000000E+00, -7.4665000000E+00])

    drcspf = np.array([3.6700000000E-01, 3.6700000000E-01, 3.6700000000E-01, 3.6700000000E-01, 3.6700000000E-01,
                       3.6700000000E-01, 4.7950000000E-01, 2.9005000000E-01, 3.4815000000E-01, 3.1910000000E-01,
                       4.0625000000E-01, 7.7950000000E-01])

    dzcspf = np.array([1.0600000000E+00, 1.0600000000E+00, 1.0600000000E+00, 1.0600000000E+00, 1.0600000000E+00,
                       1.0600000000E+00, 4.9205000000E-01, 3.5730000000E-01, 4.7690000000E-01, 4.7690000000E-01,
                       4.7690000000E-01, 5.5375000000E-01])
    return rcspf, zcspf, drcspf, dzcspf

def get_vacuum_vessel():
    vv_rinner = np.array([
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.551700000000E+00,
        3.587100000000E+00, 3.645600000000E+00, 3.726200000000E+00, 3.827900000000E+00, 3.949100000000E+00,
        4.088100000000E+00, 4.242800000000E+00, 4.411000000000E+00, 4.590200000000E+00, 4.777900000000E+00,
        4.971200000000E+00, 5.167300000000E+00, 5.363500000000E+00, 5.556800000000E+00, 5.744400000000E+00,
        5.923600000000E+00, 6.091700000000E+00, 6.247800000000E+00, 6.403900000000E+00, 6.560000000000E+00,
        6.716100000000E+00, 6.872100000000E+00, 7.032000000000E+00, 7.187200000000E+00, 7.337600000000E+00,
        7.483000000000E+00, 7.623100000000E+00, 7.757800000000E+00, 7.886700000000E+00, 8.009800000000E+00,
        8.126800000000E+00, 8.237600000000E+00, 8.342000000000E+00, 8.439800000000E+00, 8.530900000000E+00,
        8.615100000000E+00, 8.692400000000E+00, 8.762600000000E+00, 8.825600000000E+00, 8.877000000000E+00,
        8.917200000000E+00, 8.945900000000E+00, 8.964400000000E+00, 8.977400000000E+00, 8.985000000000E+00,
        8.987200000000E+00, 8.983800000000E+00, 8.975100000000E+00, 8.960800000000E+00, 8.937000000000E+00,
        8.899100000000E+00, 8.847500000000E+00, 8.782400000000E+00, 8.702900000000E+00, 8.623400000000E+00,
        8.543900000000E+00, 8.464500000000E+00, 8.385000000000E+00, 8.305500000000E+00, 8.226000000000E+00,
        8.146500000000E+00, 8.067100000000E+00, 7.987600000000E+00, 7.908100000000E+00, 7.828600000000E+00,
        7.749100000000E+00, 7.669700000000E+00, 7.590200000000E+00, 7.510700000000E+00, 7.431200000000E+00,
        7.346400000000E+00, 7.249100000000E+00, 7.140200000000E+00, 7.020000000000E+00, 6.889300000000E+00,
        6.748800000000E+00, 6.599300000000E+00, 6.441600000000E+00, 6.276600000000E+00, 6.105300000000E+00,
        5.928500000000E+00, 5.747300000000E+00, 5.562700000000E+00, 5.375600000000E+00, 5.187300000000E+00,
        4.990000000000E+00, 4.795200000000E+00, 4.605700000000E+00, 4.424500000000E+00, 4.254100000000E+00,
        4.097200000000E+00, 3.956100000000E+00, 3.832900000000E+00, 3.729600000000E+00, 3.647500000000E+00,
        3.588000000000E+00, 3.551900000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00, 3.539800000000E+00,
        3.539800000000E+00])
    
    vv_zinner = np.array([
        2.820000000000E-02, 2.254000000000E-01, 4.225000000000E-01, 6.197000000000E-01, 8.168000000000E-01,
        1.014000000000E+00, 1.211100000000E+00, 1.408300000000E+00, 1.605400000000E+00, 1.802600000000E+00,
        1.999700000000E+00, 2.196900000000E+00, 2.394000000000E+00, 2.591200000000E+00, 2.788300000000E+00,
        2.985500000000E+00, 3.182600000000E+00, 3.379800000000E+00, 3.576900000000E+00, 3.773100000000E+00,
        3.966400000000E+00, 4.154000000000E+00, 4.333200000000E+00, 4.501400000000E+00, 4.656100000000E+00,
        4.795000000000E+00, 4.916200000000E+00, 5.017800000000E+00, 5.098500000000E+00, 5.156900000000E+00,
        5.192300000000E+00, 5.204100000000E+00, 5.192200000000E+00, 5.156800000000E+00, 5.098300000000E+00,
        5.017600000000E+00, 4.915900000000E+00, 4.808100000000E+00, 4.700300000000E+00, 4.592500000000E+00,
        4.484700000000E+00, 4.376900000000E+00, 4.261900000000E+00, 4.140700000000E+00, 4.013600000000E+00,
        3.880800000000E+00, 3.742400000000E+00, 3.598700000000E+00, 3.449900000000E+00, 3.296100000000E+00,
        3.137700000000E+00, 2.974900000000E+00, 2.807900000000E+00, 2.637000000000E+00, 2.462400000000E+00,
        2.284400000000E+00, 2.103300000000E+00, 1.919300000000E+00, 1.732700000000E+00, 1.550600000000E+00,
        1.365600000000E+00, 1.178500000000E+00, 1.004900000000E+00, 8.309000000000E-01, 6.565000000000E-01,
        4.820000000000E-01, 3.075000000000E-01, 1.332000000000E-01, -4.070000000000E-02, -2.113000000000E-01,
        -3.793000000000E-01, -5.436000000000E-01, -7.031000000000E-01, -8.768000000000E-01, -1.050600000000E+00,
        -1.224300000000E+00, -1.398000000000E+00, -1.571700000000E+00, -1.745400000000E+00, -1.919200000000E+00,
        -2.092900000000E+00, -2.266600000000E+00, -2.440300000000E+00, -2.614000000000E+00, -2.787800000000E+00,
        -2.961500000000E+00, -3.135200000000E+00, -3.308900000000E+00, -3.482700000000E+00, -3.656400000000E+00,
        -3.824900000000E+00, -3.986700000000E+00, -4.140800000000E+00, -4.286300000000E+00, -4.422400000000E+00,
        -4.548400000000E+00, -4.663600000000E+00, -4.767300000000E+00, -4.859000000000E+00, -4.938100000000E+00,
        -5.004200000000E+00, -5.056900000000E+00, -5.095900000000E+00, -5.121100000000E+00, -5.132300000000E+00,
        -5.124500000000E+00, -5.092700000000E+00, -5.037300000000E+00, -4.959200000000E+00, -4.859500000000E+00,
        -4.739700000000E+00, -4.601700000000E+00, -4.447400000000E+00, -4.279300000000E+00, -4.099800000000E+00,
        -3.911600000000E+00, -3.717500000000E+00, -3.520500000000E+00, -3.323300000000E+00, -3.126200000000E+00,
        -2.929000000000E+00, -2.731900000000E+00, -2.534700000000E+00, -2.337600000000E+00, -2.140400000000E+00,
        -1.943300000000E+00, -1.746100000000E+00, -1.549000000000E+00, -1.351800000000E+00, -1.154700000000E+00,
        -9.575000000000E-01, -7.604000000000E-01, -5.632000000000E-01, -3.661000000000E-01, -1.689000000000E-01,
        2.820000000000E-02])
    return vv_rinner, vv_zinner #, vv_router, vv_zouter

       

def get_elm_coils():
    ELMUX = np.array([7.87286, 7.75846, 7.63892, 7.54573, 7.73298, 7.54573, 7.63892, 7.75946, 7.87286, 8.05846, 8.26018, 8.05846])
    ELMUY = np.array([2.02873, 1.99951, 1.96845, 1.68142, 0.00000, -1.69142, -1.96845, -1.99951, -2.02873, -1.81432, 0.00000, 1.81432])
    ELMUZ = np.array([2.84088, 3.01594, 3.18582, 3.37850, 3.37850, 3.37850, 3.18582, 3.01594, 2.84088, 2.62500, 2.62500, 2.62500])
    ELMMX = np.array([8.70609, 8.72846, 8.74360, 8.76867, 8.72923, 8.70145, 8.66249, 8.60566, 8.61968, 8.46471,
                  8.48550, 8.52367, 8.55088, 8.58951, 8.56495, 8.55012, 8.52821, 8.50629, 8.66232, 8.64810])
    ELMMY = np.array([1.01503, 1.01764, 1.01940, 1.02233, 1.01773, 1.01449, 1.00994, 0.70434, -0.50456, -1.70356,
                 -2.01370, -2.02277, -2.02922, -2.03839, -2.03256, -2.02904, -2.02384, -1.71345, -0.50705, 0.70932])
    ELMMZ = np.array([-0.27085, -0.15376, -0.03551, 0.55765, 1.15002, 1.33137, 1.51061, 1.79650, 1.79650, 1.79650,
                 1.51061, 1.33137, 1.15002, 0.55765, -0.03551, -0.15376, -0.27085, -0.55650, -0.55650, -0.55650])
    ELMLX = np.array([7.66505, 7.75572, 7.84639, 8.00927, 8.22786, 8.00927, 7.84639, 7.75572, 7.66505, 7.62534, 7.83211, 7.62534])
    ELMLY = np.array([2.05384, 2.07814, 2.10244, 1.88397, 0.00000, -1.88397, -2.10244, -2.07814, -2.05384, -1.78780, 0.00000, 1.78780])
    ELMLZ = np.array([-2.18415, -1.97897, -1.77379, -1.54500, -1.54500, -1.54500, -1.77379, -1.97897, -2.18415, -2.41000, -2.41000, -2.41000])

    return ELMUX, ELMUY, ELMUZ, ELMMX, ELMMY, ELMMZ, ELMLX, ELMLY, ELMLZ

def get_limiter():
    fw = np.array([
        [8.3950000000E+00, 6.3300000000E-01, 0.0000000000E+00],
        [8.2700000000E+00, 1.6810000000E+00, 0.0000000000E+00],
        [7.9040000000E+00, 2.4640000000E+00, 0.0000000000E+00],
        [7.4000000000E+00, 3.1790000000E+00, 0.0000000000E+00],
        [6.5870000000E+00, 3.8940000000E+00, 0.0000000000E+00],
        [5.7530000000E+00, 4.5320000000E+00, 0.0000000000E+00],
        [4.9040000000E+00, 4.7120000000E+00, 0.0000000000E+00],
        [4.3110000000E+00, 4.3240000000E+00, 0.0000000000E+00],
        [4.1260000000E+00, 3.5820000000E+00, 0.0000000000E+00],
        [4.0760000000E+00, 2.5660000000E+00, 0.0000000000E+00],
        [4.0460000000E+00, 1.5490000000E+00, 0.0000000000E+00],
        [4.0460000000E+00, 5.3300000000E-01, 0.0000000000E+00],
        [4.0670000000E+00, -4.8400000000E-01, 0.0000000000E+00],
        [4.0970000000E+00, -1.5000000000E+00, 0.0000000000E+00],
        [4.1742000000E+00, -2.5674000000E+00, 0.0000000000E+00],
        [4.3257000000E+00, -2.6514000000E+00, 0.0000000000E+00],
        [4.4408000000E+00, -2.7808000000E+00, 0.0000000000E+00],
        [4.5066000000E+00, -2.9410000000E+00, 0.0000000000E+00],
        [4.5157000000E+00, -3.1139000000E+00, 0.0000000000E+00],
        [4.4670000000E+00, -3.2801000000E+00, 0.0000000000E+00],
        [4.4064000000E+00, -3.4043000000E+00, 0.0000000000E+00],
        [4.4062000000E+00, -3.4048000000E+00, 0.0000000000E+00],
        [4.3773000000E+00, -3.4799000000E+00, 0.0000000000E+00],
        [4.3115000000E+00, -3.6148000000E+00, 0.0000000000E+00],
        [4.2457000000E+00, -3.7497000000E+00, 0.0000000000E+00],
        [4.1799000000E+00, -3.8847000000E+00, 0.0000000000E+00],
        [4.4918000000E+00, -3.9092000000E+00, 0.0000000000E+00],
        [4.5687000000E+00, -3.8276000000E+00, 0.0000000000E+00],
        [4.6456000000E+00, -3.7460000000E+00, 0.0000000000E+00],
        [4.8215000000E+00, -3.7090000000E+00, 0.0000000000E+00],
        [4.9982000000E+00, -3.7414000000E+00, 0.0000000000E+00],
        [5.1496000000E+00, -3.8382000000E+00, 0.0000000000E+00],
        [5.2529000000E+00, -3.9852000000E+00, 0.0000000000E+00],
        [5.2628000000E+00, -4.1244000000E+00, 0.0000000000E+00],
        [5.2727000000E+00, -4.2636000000E+00, 0.0000000000E+00],
        [5.5650000000E+00, -4.5559000000E+00, 0.0000000000E+00],
        [5.5650000000E+00, -4.4026000000E+00, 0.0000000000E+00],
        [5.5650000000E+00, -4.2494000000E+00, 0.0000000000E+00],
        [5.5650000000E+00, -4.0962000000E+00, 0.0000000000E+00],
        [5.5720000000E+00, -3.9961000000E+00, 0.0000000000E+00],
        [5.5720000000E+00, -3.9956000000E+00, 0.0000000000E+00],
        [5.5720000000E+00, -3.8960000000E+00, 0.0000000000E+00],
        [5.5720000000E+00, -3.8950000000E+00, 0.0000000000E+00],
        [5.6008000000E+00, -3.7024000000E+00, 0.0000000000E+00],
        [5.6842000000E+00, -3.5265000000E+00, 0.0000000000E+00],
        [5.8150000000E+00, -3.3823000000E+00, 0.0000000000E+00],
        [5.9821000000E+00, -3.2822000000E+00, 0.0000000000E+00],
        [6.1710000000E+00, -3.2350000000E+00, 0.0000000000E+00],
        [6.2670000000E+00, -3.0460000000E+00, 0.0000000000E+00],
        [7.2830000000E+00, -2.2570000000E+00, 0.0000000000E+00],
        [7.8990000000E+00, -1.3420000000E+00, 0.0000000000E+00],
        [8.3060000000E+00, -4.2100000000E-01, 0.0000000000E+00],
        [8.3950000000E+00, 6.3300000000E-01, 0.0000000000E+00]])
    return fw
    

def plot_ITER_geo():
    rtf1, ztf1, rtf2, ztf2 = get_plasma_boundary()
    rcspf, zcspf, drcspf, dzcspf = get_cs_coils()
    #vv_rinner, vv_zinner, vv_router, vv_zouter = get_vacuum_vessel()
    vv_rinner, vv_zinner = get_vacuum_vessel()
    ELMUX, ELMUY, ELMUZ, ELMMX, ELMMY, ELMMZ, ELMLX, ELMLY, ELMLZ = get_elm_coils()
    fw = get_limiter()

    plt.figure(dpi=100)
    plt.axis('equal')

    # Plasma boundary
    plt.plot(rtf1, ztf1, 'k')
    plt.plot(rtf2, ztf2, 'k')

    # CS coils
    for n in range(len(rcspf)):
        x = [rcspf[n] - drcspf[n], rcspf[n] + drcspf[n], rcspf[n] + drcspf[n], rcspf[n] - drcspf[n]]
        y = [zcspf[n] - dzcspf[n], zcspf[n] - dzcspf[n], zcspf[n] + dzcspf[n], zcspf[n] + dzcspf[n]]
        plt.fill(x, y, 'b', alpha=0.25)

    # Fixed coil boxes
    plt.fill([5.8261 - 0.0730, 5.8261 + 0.0730, 5.8261 + 0.0730, 5.8261 - 0.0730],
             [4.9249 - 0.0690, 4.9249 - 0.0690, 4.9249 + 0.0690, 4.9249 + 0.0690],'b')
    plt.fill([7.5222 - 0.0730, 7.5222 + 0.0730, 7.5222 + 0.0730, 7.5222 - 0.0730],
             [-2.4912 - 0.0690, -2.4912 - 0.0690, -2.4912 + 0.0690, -2.4912 + 0.0690],'b')

    # Red regions
    red_boxes = [
        ([5.6976, 7.4488], [7.07560]),
        ([5.6976, 7.4488], [-7.34670]),
        ([11.2970], [-2.9483, 3.8855])
    ]
    for x_center, y_center in red_boxes:
        if len(x_center) == 2:
            x = [x_center[0] - 0.1038 / 2, x_center[1] + 0.1038 / 2] * 2
            y = [y_center[0] - 0.1891 / 2, y_center[0] - 0.1891 / 2,
                 y_center[0] + 0.1891 / 2, y_center[0] + 0.1891 / 2]
        else:
            x = [x_center[0] - 0.1240 / 2, x_center[0] + 0.1240 / 2] * 2
            y = [y_center[0], y_center[0], y_center[1], y_center[1]]
        plt.fill(x, y, 'r', alpha=0.25)

    # ELM Control coils
    ELMUR = np.sqrt(ELMUX**2 + ELMUY**2)
    ELMMR = np.sqrt(ELMMX**2 + ELMMY**2)
    ELMLR = np.sqrt(ELMLX**2 + ELMLY**2)
    plt.plot([min(ELMUR), max(ELMUR)], [max(ELMUZ), min(ELMUZ)], 'r')
    plt.plot([max(ELMMR), max(ELMMR)], [min(ELMMZ), max(ELMMZ)], 'r')
    plt.plot([min(ELMLR), max(ELMLR)], [min(ELMLZ), max(ELMLZ)], 'r')

    # Limiter and VV components
    plt.plot(fw[:, 0], fw[:, 1], 'k')
    plt.plot(vv_rinner, vv_zinner, '-.b')
    #plt.plot(vv_router, vv_zouter, '-.b')

    plt.title("ITER Cross Section")
    plt.xlabel("R [m]")
    plt.ylabel("Z [m]")
    plt.grid(True)
    plt.tight_layout()
    plt.show()

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Plot ITER Cross Section.')
    parser.parse_args()
    plot_iter()

